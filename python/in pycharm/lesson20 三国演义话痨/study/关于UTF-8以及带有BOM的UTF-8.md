### 关于UTF-8以及带有BOM的UTF-8

#### 一. 计算机存储数据的方法

在计算机中，所有的数据在存储和运算时都要使用二进制数表示（因为计算机用高电平和低电平分别表示1和0），例如，像a、b、c、d这样的52个字母（包括大写）以及0、1等数字还有一些常用的符号（例如*、#、@等）在计算机中存储时也要使用二进制数来表示，而具体用哪些二进制数字表示哪个符号，当然每个人都可以约定自己的一套（这就叫编码），而大家如果要想互相通信而不造成混乱，那么大家就必须使用相同的编码规则，于是美国有关的标准化组织就出台了ASCII编码，统一规定了上述常用符号用哪些二进制数来表示。

- ![1648265281716.png](https://imgtp.apqiang.com/2022/04/01/LLSQeyIG.png)



#### 二. 什么是Unicode(Universal Multiple-Octet Coded Character Set )

1. 统一码(Unicode)也叫万国码、单一码，是计算机科学领域里的一项业界标准，包括字符集、编码方案等。Unicode是为了解决传统的字符编码方案的局限而产生的，它为每种语言中的每个字符设定了统一并且唯一的，以满足跨语言、跨平台进行文本转换、处理的要求。 

2. 在这种语言环境下，不会再有语言的编码冲突，在同屏下，可以显示任何语言的内容，这就是Unicode的最大好处。就是将世界上所有的文字用2个字节统一进行编码。那样，像这样统一编码，2个字节就已经足够容纳世界上所有的语言的大部分文字了。 

3. Unicode可看做一本书，书中记载了各种语言用两个字节的表达形式（如汉字“字”---->23383），也叫作码点。但==不是==计算机最后储存信息的形式。

#### 三. UTF-8出来之前人们常用的一些编码

##### 1. 为什么不用ASCII？

原因：

1. ASCII编码由美国发明的，只含有英文字母、英语中的符号以及一些转义字符。而Unicode记载很多国家的语言，无法做到一一对应；
2. 按照ASCII的存储方式（计算机用固定的8比特来储存字符），那么其他国家的语言的字符就无法表示了。

##### 2.  一些常见编码及Unicode

- 大陆：GB2312、GBK
- 台湾地区：big6

 ![1648264898852.png](https://imgtp.apqiang.com/2022/04/01/AbVmBbHS.png) 

当各个地区都出现了各自的编码规则后，那么同一份文件发送至不同地区就可能出现不同的内容（即乱码）。

 ![1648265074988.png](https://imgtp.apqiang.com/2022/04/01/asEH1o8J.png) 



为了解决这个问题，于是人们发明了Unicode编码，它将各种语言(包括古文字)甚至表情都制定了对应的码点。（Unicode前面的部分仍然为ASCII）

- ![1648265223071.png](https://imgtp.apqiang.com/2022/04/01/jcFwOTpP.png)

### 四. UTF-8和UTF-32

##### 1. 出现原因

1. 将Unicode对应字符的码点转换为便于在计算机中存储的二进制模式。
2. Unicode储存的东西太多，原有的如果按照ASCII标准就放不下了。

##### 2. UTF-32

 UTF-32 是一种将Unicode的协定，对每一个Unicode码位使用恰好32位元（即4字节）。 

缺点：

1. 浪费空间：因为要以4字节存储，故前面多出的部分要用0来补齐。那么对于英文和其他只暂2字节语言的使用者来说都话就浪费空间了。
2. 看着不舒服。

   - ![1648265935046.png](https://imgtp.apqiang.com/2022/04/01/nskYPjPl.png)

综上，人们发明了UTF-8。

##### 3. UTF-8

 UTF-8（Universal Character Set/Unicode Transformation Format）是针对Unicode的一种==可变==长度字符编码。它可以用来表示Unicode标准中的任何字符，。

例：

- ![1648266021467.png](https://imgtp.apqiang.com/2022/04/01/SWEbhuMX.png)

规则

 ![1648266262841.png](https://imgtp.apqiang.com/2022/04/01/11H6Fcl3.png) 

可以伸缩，方便又节省空间。

##### 4. 带BOM的UTF-8

1. 大端和小端

   在CSAPP中提到过，计算计对于数据有两种存储方式，大端和小端。

   1. 12345 转化为 16 进制 >> 0x3039
   2. 算上前面的 0， 写成以字为单位的形式：00 00 30 39
   3. 大端法：00 00 30 39
      小端法：39 30 00 00
   4. 假设第一个字节地址是0x100，则两种存储方法对应的图形表述如下图
       ![QQ截图20220401193300.png](https://imgtp.apqiang.com/2022/04/01/9zChUFDH.png) 

2. BOM的含义

 	BOM即Byte Order Mark字节序标记。BOM是为UTF-16和UTF-32准备的，用户标记字节序（byte order）。拿UTF-16来举例，其是以两个字节为编码单元，在解释一个UTF-16文本前，首先要弄清楚每个编码单元的字节序。例如收到一个“奎”的Unicode编码是594E，“乙”的Unicode编码是4E59。如果我们收到UTF-16字节流"594E"，那么这是“奎”还是“乙”？

于是 UCS规范建议我们在传输字节流前，先传输字符"ZERO WIDTH NO-BREAK SPACE"。这样如果接收者接收到FEFF，就表明这个字节流是Big-Endian的；如果收到FFFE，就表明这个字节流是Little-Endian的。因此字符"ZERO WIDTH NO-BREAK SPACE"又被称为BOM 。

最好不要选择带BOM的UTF-8编码形式，原因我看不懂。（ https://www.cnblogs.com/codingmengmeng/p/11028744.html ）

